---
import axios from "axios";
import Layout from "../layouts/MainLayout.astro";

export const prerender = true;

if (Astro.request.method === "POST") {
  try {
    const data = await Astro.request.formData();
    const correo = data.get("correo");
    const contraseña = data.get("contraseña");
    const apiUrl = "http://127.0.0.1:8000/api/clientes/register/";
    const response = await axios.post(apiUrl, { correo, contraseña });

    if (response.status === 201) {
      // Mostrar una respuesta de registro de cuenta exitosa
      console.log(`Se ha registrado el usuario ${correo} exitosamente`);
      // Redirigir a otra página
      return Astro.redirect("/iniciar-sesion");
    } else {
      console.error("Error al crea cuenta:", response.statusText);
    }
  } catch (error) {
    if (error instanceof Error) {
      console.error("Error al crea cuenta:", error.message);
    }
  }
}
---

<!-- formualrio Registrarse -->
<Layout title="Registrarse">
  <div class="justify-center min-h-[calc(100vh-4rem)] pt-8">
    <div class="max-w-2xl mx-auto p-4 lg:p-6 md:p-5 sm:p-4">
      <h1 class="text-4xl font-semibold mb-8 text-center">Registrar nueva cuenta</h1>
      <h2 class="text-2xl font-semibold mb-4">Datos personales:</h2>
      <form method="POST">
        <fieldset class="mb-4 grid grid-cols-1 md:grid-cols-2 md:gap-4">
          <div class="mb-4 md:mb-0">
            <label
              for="name"
              class="block text-gray-600 dark:text-gray-300 mb-2"
              >Nombres
              <span class="text-red-500 font-bold">*</span>
            </label>
            <input
              type="text"
              id="name"
              name="nombre"
              required
              placeholder="Ingrese sus nombres"
              class="w-full border text-black dark:text-black border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:border-blue-500"
            />
          </div>
          <div>
            <label
              for="last-name"
              class="block text-gray-600 dark:text-gray-300 mb-2"
              >Apellidos
              <span class="text-red-500 font-bold">*</span>
            </label>
            <input
              type="text"
              id="last-name"
              name="apellido"
              required
              placeholder="Ingrese sus apellidos"
              class="w-full border text-black dark:text-black border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:border-blue-500"
            />
          </div>
        </fieldset>
        <fieldset class="mb-4 grid grid-cols-1 md:grid-cols-2 md:gap-4">
          <div class="mb-4 md:mb-0">
            <label
              for="document"
              class="block text-gray-600 dark:text-gray-300 mb-2"
              >DNI
              <span class="text-red-500 font-bold">*</span>
            </label>
            <input
              type="text"
              id="document"
              name="documento"
              required
              placeholder="Ingrese su DNI"
              class="w-full border text-black dark:text-black border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:border-blue-500"
            />
          </div>
          <div>
            <label
              for="sex"
              class="block text-gray-600 dark:text-gray-300 mb-2"
            >
              Sexo
              <span class="text-red-500 font-bold">*</span>
            </label>
            <select
              id="sex"
              name="sexo"
              required
              class="w-full border text-black dark:text-black border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:border-blue-500"
            >
              <option value="">Seleccione una opción</option>
              <option value="Masculino">Masculino</option>
              <option value="Femenino">Femenino</option>
              <option value="Otro">Otro</option>
            </select>
          </div>
        </fieldset>
        <fieldset class="mb-4 flex flex-col md:flex-row md:space-x-4">
          <div class="md:w-1/2 mb-4 md:mb-0">
            <label
              for="fecha-nacimiento"
              class="block text-gray-600 dark:text-gray-300 mb-2"
              >Fecha de nacimiento
              <span class="text-red-500 font-bold">*</span>
              </label
            >
            <input
              type="date"
              id="fecha-nacimiento"
              name="fecha_nacimiento"
              required
              class="w-full border text-black dark:text-black border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:border-blue-500"
            />
          </div>
          <div class="md:w-1/2">
            <label
              for="phone"
              class="block text-gray-600 dark:text-gray-300 mb-2"
              >Teléfono
              <span class="text-red-500 font-bold">*</span>
              </label
            >
            <input
              type="number"
              id="phone"
              name="telefono"
              required
              inputmode="numeric"
              oninput="if(this.value.length > 9) this.value = this.value.slice(0, 9);"
              class="w-full border text-black dark:text-black border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:border-blue-500"
              placeholder="Ingrese su número de teléfono"
            />
          </div>
        </fieldset>
        <h2 class="text-2xl font-semibold mb-4">Correo y contraseña:</h2>
        <div class="mb-4">
          <label for="email" class="block text-gray-600 dark:text-gray-300 mb-2"
            >Correo electrónico
            <span class="text-red-500 font-bold">*</span>
          </label>
          <input
            type="email"
            id="email"
            name="correo"
            required
            placeholder="Ingrese su correo"
            class="w-full border text-black dark:text-black border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:border-blue-500"
          />
        </div>
        <fieldset class="mb-4 grid grid-cols-1 md:grid-cols-2 md:gap-4">
          <div class="mb-4 md:mb-0">
            <label
              for="password"
              class="block text-gray-600 dark:text-gray-300 mb-2"
              >Contraseña
              <span class="text-red-500 font-bold">*</span>
            </label>
            <input
              type="password"
              id="password"
              name="contraseña"
              required
              placeholder="Ingrese su contraseña"
              class="w-full border text-black dark:text-black border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:border-blue-500"
            />
          </div>
          <div>
            <label
              for="password-2"
              class="block text-gray-600 dark:text-gray-300 mb-2"
              >Confirmar contraseña
              <span class="text-red-500 font-bold">*</span>
            </label>
            <input
              type="password"
              id="contraseña-2"
              required
              placeholder="Vuelva a ingresar su contraseña"
              class="w-full border text-black dark:text-black border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:border-blue-500"
            />
          </div>
        </fieldset>
        <div>
          <button
            type="submit"
            class="bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-md py-2 px-4 w-full"
            >Crear mi cuenta</button
          >
        </div>
        <div class="mt-6 text-blue-500 text-center">
          <a href="/iniciar-sesion" class="hover:underline">Deseo iniciar sesión</a>
        </div>
      </form>
    </div>
  </div>
</Layout>
