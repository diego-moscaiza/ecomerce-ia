---
import Layout from "../layouts/MainLayout.astro";
---

<Layout title="Compras">
  <header>
    <h2 class="mt-8 mb-0 pb-5 text-2xl text-center font-semibold">
      CONFIRMAR COMPRAS
    </h2>
  </header>
  <div class="rounded-lg shadow-lg p-6 max-w-md mx-auto">
    <h2 class="text-2xl font-bold mb-4">Información Personal</h2>

    <div class="space-y-3">
      <input
        class="w-full p-2 border border-gray-300 rounded dark:text-gray-700"
        type="text"
        placeholder="Nombre del cliente"
      />
      <input
        class="w-full p-2 border border-gray-300 rounded dark:text-gray-700"
        type="text"
        placeholder="+51 987 623 418"
      />
      <input
        class="w-full p-2 border border-gray-300 rounded dark:text-gray-700"
        type="text"
        placeholder="Wall Street Avenue"
      />
    </div>

    <div class="mt-6">
      <label class="block text-sm font-bold mb-2">Método de pago</label>
      <select
        class="w-full p-2 rounded border border-gray-300 dark:text-gray-900"
        title="a"
        id="payment-method"
        onchange="showCardDetails()"
      >
        <option value="">Selecciona un método de pago</option>
        <option value="visa">VISA</option>
        <!-- Agrega aquí más métodos de pago -->
      </select>

      <div id="card-details" class="space-y-3 mt-4 hidden">
        <input
          class="w-full p-2 border border-gray-300 rounded dark:text-gray-700"
          type="text"
          placeholder="Número de tarjeta"
        />
        <input
          class="w-full p-2 border border-gray-300 rounded dark:text-gray-700"
          type="text"
          placeholder="Fecha de vencimiento"
        />
        <input
          class="w-full p-2 border border-gray-300 rounded dark:text-gray-700"
          type="text"
          placeholder="CVV"
        />
      </div>
    </div>

    <!-- Aquí puedes agregar el resto de la página tal como se muestra en la imagen -->

    <div class="mt-6">
      <label class="block text-sm font-bold mb-2"
        >Lista de productos a comprar</label
      >
      <div id="productListContainer"></div>
    </div>

    <div class="mt-6">
      <div class="flex justify-between items-center">
        <span>Total a pagar:</span>
        <span class="text-lg font-bold">S./ 80.00</span>
      </div>
      <div class="flex space-x-2 mt-4">
        <button
          class="flex-1 py-2 bg-blue-500 text-white rounded"
          onclick="location.href=''">Confirmar compra</button
        >
        <button
          class="flex-1 py-2 bg-red-500 text-white rounded"
          onclick="location.href='./cesta'">Cancelar</button
        >
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const selectedProducts =
        JSON.parse(localStorage.getItem("selectedProducts")) || [];
      const productListContainer = document.getElementById(
        "productListContainer",
      );

      if (selectedProducts.length > 0) {
        selectedProducts.forEach((product, index) => {
          const productElement = document.createElement("div");
          productElement.className = "flex items-center space-x-2";
          productElement.innerHTML = `
            <img class="w-16 h-16 object-cover" src="${product.image}" alt="Imagen del producto" />
            <div class="flex-1">
              <h3 class="text-lg font-bold">${product.name}</h3>
              <p class="text-gray-500">S./ ${product.price.toFixed(2)}</p>
            </div>
            <div class="flex items-center space-x-1">
              <button class="decrement px-2 font-semibold bg-gray-200 dark:bg-gray-700">-</button>
              <span class="number mx-2 font-semibold">${product.quantity}</span>
              <button class="increment px-2 font-semibold bg-gray-200 dark:bg-gray-700">+</button>
            </div>
          `;
          productListContainer.appendChild(productElement);

          // Add event listeners for increment and decrement buttons
          productElement
            .querySelector(".decrement")
            .addEventListener("click", () => {
              if (product.quantity > 1) {
                product.quantity -= 1;
                productElement.querySelector(".number").textContent =
                  product.quantity;
                updateSelectedProducts(selectedProducts);
                calculateTotal(); // Recalculate total after changing quantity
              }
            });

          productElement
            .querySelector(".increment")
            .addEventListener("click", () => {
              product.quantity += 1;
              productElement.querySelector(".number").textContent =
                product.quantity;
              updateSelectedProducts(selectedProducts);
              calculateTotal(); // Recalculate total after changing quantity
            });
        });

        function calculateTotal() {
          let total = 0;
          selectedProducts.forEach((product: any) => {
            total += product.price * product.quantity;
          });
          document.querySelector("span.font-bold").textContent =
            `S./ ${total.toFixed(2)}`;
        }

        calculateTotal();

        function updateSelectedProducts(products: any) {
          localStorage.setItem("selectedProducts", JSON.stringify(products));
        }
      } else {
        productListContainer.innerHTML =
          "<p>No hay productos seleccionados para comprar.</p>";
      }
    });
  </script>
</Layout>
